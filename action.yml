name: "LOC Graph Action"
description: "Generate an SVG chart of Lines of Code over time from commit history"
author: "Your Name"
inputs:
  output_svg:
    description: "Path to output SVG"
    default: ".github/loc-history.svg"
    required: false
  output_json:
    description: "Path to cached LOC history JSON"
    default: ".github/loc_history.json"
    required: false
runs:
  using: "composite"
  steps:
    - name: Ensure full git history
      shell: bash
      run: |
        if [ "$(git rev-parse --is-shallow-repository)" = "true" ]; then
          git fetch --unshallow --tags
        fi

    - name: Install cloc & Python
      shell: bash
      run: |
        sudo apt-get update
        sudo apt-get install -y cloc python3 python3-pip
        python3 -m pip install --upgrade pip

    - name: Run LOC graph generator
      shell: bash
      run: |
        python3 "${GITHUB_ACTION_PATH}/scripts/loc_graph.py"

    - name: Commit artifacts if changed
      shell: bash
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git add "${{ inputs.output_svg }}" "${{ inputs.output_json }}" || true
        if ! git diff --cached --quiet; then
          git commit -m "Update LOC graph [skip ci]"
          git push
        fi
        
